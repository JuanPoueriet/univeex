<div class="container booking-page">
  <div class="booking-container">
    <div class="steps-indicator">
      <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
        <div class="step-number">1</div>
        <div class="step-label">{{ 'BOOKING.STEP_1' | translate }}</div>
      </div>
      <div class="line" [class.active]="currentStep() > 1"></div>
      <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
        <div class="step-number">2</div>
        <div class="step-label">{{ 'BOOKING.STEP_2' | translate }}</div>
      </div>
      <div class="line" [class.active]="currentStep() > 2"></div>
      <div class="step" [class.active]="currentStep() >= 3">
        <div class="step-number">3</div>
        <div class="step-label">{{ 'BOOKING.STEP_3' | translate }}</div>
      </div>
    </div>

    <div class="booking-content">
      <form [formGroup]="bookingForm">

        @if (currentStep() === 1) {
          <div class="step-content">
            <h2>Selecciona los detalles</h2>

            <div class="form-group">
              <label class="form-label">Excursión</label>
              <select class="form-control" formControlName="excursionId">
                <option value="">Selecciona una excursión</option>
                @for (ex of excursions$ | async; track ex.id) {
                  <option [value]="ex.id">{{ ex.title }} (\${{ ex.price }})</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Fecha</label>
              <input type="date" class="form-control" formControlName="date">
            </div>

            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label class="form-label">Adultos</label>
                  <input type="number" class="form-control" formControlName="adults" min="1">
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label class="form-label">Niños (50% desc.)</label>
                  <input type="number" class="form-control" formControlName="children" min="0">
                </div>
              </div>
            </div>
          </div>
        }

        @if (currentStep() === 2) {
          <div class="step-content">
            <h2>Tus Datos</h2>
            <div class="form-group">
              <label class="form-label">Nombre Completo</label>
              <input type="text" class="form-control" formControlName="customerName" placeholder="Juan Pérez">
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" formControlName="customerEmail" placeholder="juan@example.com">
            </div>
            <div class="form-group">
              <label class="form-label">Teléfono / WhatsApp</label>
              <input type="tel" class="form-control" formControlName="customerPhone" placeholder="+1 ...">
            </div>
          </div>
        }

        @if (currentStep() === 3) {
          <div class="step-content">
            <h2>Resumen y Pago</h2>
            <div class="summary-card">
              <div class="summary-item">
                <span>Excursión:</span>
                <strong>{{ getExcursionName() }}</strong>
              </div>
              <div class="summary-item">
                <span>Fecha:</span>
                <strong>{{ bookingForm.get('date')?.value }}</strong>
              </div>
              <div class="summary-item">
                <span>Personas:</span>
                <strong>{{ bookingForm.get('adults')?.value }} Adultos, {{ bookingForm.get('children')?.value }} Niños</strong>
              </div>
              <div class="total-price">
                <span>Total Estimado:</span>
                <span class="amount">\${{ totalPrice() | number:'1.2-2' }}</span>
              </div>
            </div>

            <div class="alert-info">
              <i class="fas fa-info-circle"></i> El pago se realizará en el siguiente paso de forma segura.
            </div>
          </div>
        }

        <div class="form-actions">
          @if (currentStep() > 1) {
            <button type="button" class="btn btn-secondary" (click)="prevStep()">
              {{ 'BOOKING.PREV' | translate }}
            </button>
          }

          @if (currentStep() < 3) {
            <button type="button" class="btn btn-tropical" (click)="nextStep()" [disabled]="!isStepValid()">
              {{ 'BOOKING.NEXT' | translate }}
            </button>
          } @else {
            <button type="submit" class="btn btn-tropical" (click)="submitBooking()" [disabled]="bookingForm.invalid">
              {{ 'BOOKING.CONFIRM' | translate }}
            </button>
          }
        </div>
      </form>
    </div>
  </div>
</div>